<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family tree</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
   <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <!-- Dropdown menu to select the start person -->
  <select id="startSelector">
    <option disabled selected>Select Root Person</option>
    <option value="id34">Joshua Russell (Generation -5)</option>
    <option value="id32">Jacob Russell (Generation -4)</option>
    <option value="id30">Joheph Russell (Generation -3)</option>
    <option value="id19">George Lawrence Russell (Generation -2)</option>
    <option value="id4">Judy Russell (Generation -1)</option>
    <option value="id1">Lucas Wilson (Gen 0)</option>
  </select>

  <!-- Person info and tree button -->
   <button id="refreshbutton" onClick="window.location.href=window.location.href">Start over</button>
  <button id="logButton">Show details of these people</button>
  <div id="personInfoContainer"></div>

  <!-- Scripts -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="js/d3-dag.js"></script>
  <script src="data/data_wilson.js"></script>
  <script src="js/familytree.js"></script>

  <script>

    
    // Wait for DOM and user to select start node
    document.getElementById("startSelector").addEventListener("change", function () {
      const selectedId = this.value;
      
      // Set data.start before doing anything else
      data.start = selectedId;

      // Build SVG for tree
      const svg = d3.select("body").append("svg")
        .attr("width", document.body.offsetWidth)
        .attr("height", document.documentElement.clientHeight);

      // Create FamilyTree and draw it
      let FT = new FamilyTree(data, svg).orientation("vertical");
      FT.draw();

      // Setup log button
      setTimeout(() => {
        const button = document.getElementById("logButton");
        const button2 = document.getElementById("refreshbutton");
        const container = document.getElementById("personInfoContainer");

        let isVisible = false; // state to track toggle

        button.addEventListener("click", () => {
          if (!container) return;

          if (isVisible) {
            // Hide content
            container.innerHTML = "";
            isVisible = false;
            button.textContent = "Show deatils"; // optional label change
          } else {
            // Show content
            container.innerHTML = "";

            d3.selectAll("circle.person").each(function (d) {
              const person = d?.data || d || {};
              const name = person.name || "Unknown";
              const birth = person.birthplace || "â€“";
              const url = person.url || "";
              const birthdate = person.birthdate || "";

              let content = `
                <strong>${name}</strong><br>
                <span>Birthplace: ${birth}</span><br>
                <span>Birth Date: ${birthdate}</span><br>
              `;

              if (url && url.trim() !== "") {
                content += `<a href="${url}" target="_blank" rel="noopener noreferrer">Profile</a>`;
              }

              const box = document.createElement("div");
              box.className = "personBox";
              box.innerHTML = content;
              container.appendChild(box);
            });

            isVisible = true;
            button.textContent = "Hide deatils"; // optional label change
          }
        });

      }, 1000);


      // Optionally hide selector after selection
      this.style.display = "none";
    });


    
  </script>
</body>
</html>
