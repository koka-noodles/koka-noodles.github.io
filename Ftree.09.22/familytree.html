<!DOCTYPE html>

<!--
    collapsible directed acyclical graph for family tree visualization
    author: Benjamin W. Portner
    license: GNU General Public License v3.0

    based on d3 collapsible treemap example by d3noob: https://bl.ocks.org/d3noob/43a860bc0024792f8803bba8ca0d5ecd
    features in the original:
    - d3 tree
    - collapsible
    - transitions
    new features:
    - two types of nodes: unions and persons
    - d3 dag instead of tree (to allow two parents per union)
    - collapse/expand in all directions (memory function)
    - tooltips: show node metadata on hover
-->

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/main.css">
    <!-- Comment -->
</head>

<body>

 <!-- Fullscreen overlay with dropdown -->
  <div id="selectOverlay">
    <label for="dropdown">Choose a person to begin:</label>
    <select id="dropdown">
      <option value="" disabled selected>-- Select Person --</option>
      <option value="id26">George Herbert</option>
      <option value="id13">Margaret Rose</option>
      <option value="id7">William the Bold</option>
    </select>
  </div>

  <script>
    let selectedOption = null;

    document.getElementById("dropdown").addEventListener("change", function () {
      selectedOption = this.value;
      console.log("Selected:", selectedOption);

      // Hide dropdown UI
      document.getElementById("selectOverlay").style.display = "none";

      // Load dependencies in order, then run logic
      loadScriptsSequentially([
        "https://d3js.org/d3.v7.min.js",
        "js/d3-dag.js",
        "data/data_wilson.js",
        "js/familytree.js"
      ], () => {
        runPageLogic(selectedOption);
      });
    });

    function runPageLogic(selectedId) {
      // Your main logic begins here after all scripts are loaded
      const svg = d3.select("body").append("svg")
        .attr("width", window.innerWidth)
        .attr("height", window.innerHeight);

      const subtree = buildSubtree(data, selectedId);
      const FT = new FamilyTree(subtree, svg)
        .orientation("vertical");
      FT.draw();
    }

    function loadScriptsSequentially(scripts, callback) {
      const load = (i) => {
        if (i >= scripts.length) return callback();
        const s = document.createElement("script");
        s.src = scripts[i];
        s.onload = () => load(i + 1);
        s.onerror = () => console.error("Failed to load script:", scripts[i]);
        document.head.appendChild(s);
      };
      load(0);
    }
  </script>

    </script>

    

</body>